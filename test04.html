<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>代理店検索</title>
</head>
<body>

    <h2>代理店検索</h2>
    <label for="ag_number">代理店番号：</label>
    <input type="text" id="ag_number" name="ag_number" oninput="handleAgentInput()">
    <p id="agent_name" style="margin-top: 10px;"></p>
    <p id="agent_address" style="margin-top: 5px;"></p> <!-- 住所用の要素を追加 -->

    <script>
        async function fetchAgents() {
            try {
                const response = await fetch("https://asiro-ssi.viewer.kintoneapp.com/public/api/records/agent-number/1");
                if (!response.ok) {
                    throw new Error("データ取得に失敗しました");
                }
                const data = await response.json();
                return data.records;
            } catch (error) {
                console.error("エラー:", error);
                return [];
            }
        }

        async function handleAgentInput() {
            const inputNumber = document.getElementById("ag_number").value.trim();
            const agentNameElement = document.getElementById("agent_name");
            const agentAddressElement = document.getElementById("agent_address");

            if (inputNumber === "") {
                agentNameElement.textContent = "";
                agentAddressElement.textContent = "";
                return;
            }

            const records = await fetchAgents();
            const matchedAgent = records.find(record => record.Agency_No.value === inputNumber);

            if (matchedAgent) {
                agentNameElement.textContent = matchedAgent.Agency_Name1.value;
                agentAddressElement.textContent = matchedAgent.Address1_FULL.value; // 住所を表示
            } else {
                agentNameElement.textContent = "該当する代理店が見つかりません";
                agentAddressElement.textContent = "";
            }
        }
    </script>

</body>
</html>
